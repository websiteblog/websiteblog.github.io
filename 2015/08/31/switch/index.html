
<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="websit blog">
    <title>create view and switch view - websit blog</title>
    <meta name="author" content="mengyue">
    
    
    <meta name="description" content="pageView扩展backbone
cAbstractApp定义view加载、切换、回退、跳转—webApp/cWebViewApp/hybirdApp为其子类1、cWebApp扩展了父类的bindEvents,start,goTo,goBack,jump,judgeForward2、webviewApp扩展了父类的bindEvents,_getCurrentView,start,goTo,go">
<meta property="og:type" content="blog">
<meta property="og:title" content="create view and switch view">
<meta property="og:url" content="http://websiteblog.github.io/2015/08/31/switch/index.html">
<meta property="og:site_name" content="websit blog">
<meta property="og:description" content="pageView扩展backbone
cAbstractApp定义view加载、切换、回退、跳转—webApp/cWebViewApp/hybirdApp为其子类1、cWebApp扩展了父类的bindEvents,start,goTo,goBack,jump,judgeForward2、webviewApp扩展了父类的bindEvents,_getCurrentView,start,goTo,go">
<meta property="og:updated_time" content="2015-09-20T05:21:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="create view and switch view">
<meta name="twitter:description" content="pageView扩展backbone
cAbstractApp定义view加载、切换、回退、跳转—webApp/cWebViewApp/hybirdApp为其子类1、cWebApp扩展了父类的bindEvents,start,goTo,goBack,jump,judgeForward2、webviewApp扩展了父类的bindEvents,_getCurrentView,start,goTo,go">
    
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">websit blog</a>
    </h1>
    
</header>
            <nav id="sidebar" data-behavior="4">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Início</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categorias</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Arquivo</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Pesquisar</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">Sobre</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            create view and switch view
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Aug 31 2015 14:05:50 GMT+0800">
	
		    31/08/2015
    	
    </time>
    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>pageView扩展backbone</p>
<h2 id="cAbstractApp定义view加载、切换、回退、跳转—webApp/cWebViewApp/hybirdApp为其子类">cAbstractApp定义view加载、切换、回退、跳转—webApp/cWebViewApp/hybirdApp为其子类</h2><p>1、cWebApp扩展了父类的bindEvents,start,goTo,goBack,jump,judgeForward<br>2、webviewApp扩展了父类的bindEvents,_getCurrentView,start,goTo,goBack,startObserver,endObserver,judgeForward<br>3、hybridApp扩展了父类的bindEvents,start,loadFromRoute,_getCurrentView,goTo,goBack,jump,startObserver,endObserver,judgeForward<br>cBaseInit根据Lizard.pdConfig返回实例化abstractApp的方法。<br>不同环境加载的文件:<br>在APP，但不是hybrid方式：加载cHybridAppInit、cStatic、cBaseInit<br>Hybrid：加载cHybridAppInit、cBaseInit<br>其他方式：cWebAppInit</p>
<p>/**cWebInit的作用</p>
<ul>
<li>define([‘cBaseInit’, ‘cWebMember’], function(initFunc, Member){<br>Member.autoLogin({<br> callback: function(){<br>   require([‘cStatic’], function(){<pre><code>initFunc()<span class="comment">;</span>
</code></pre>   });<br> }<br>});<br>})<br>*/<br>一、backbone view的实现<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * backbone view构造函数，</span><br><span class="line"> * @param &#123;[type]&#125; options [description]</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> viewOptions = [<span class="string">'model'</span>, <span class="string">'collection'</span>, <span class="string">'el'</span>, <span class="string">'id'</span>, <span class="string">'attributes'</span>, <span class="string">'className'</span>, <span class="string">'tagName'</span>, <span class="string">'events'</span>];</span><br><span class="line"><span class="keyword">var</span> View = Backbone.View = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cid = _.uniqueId(<span class="string">'view'</span>);</span><br><span class="line">  options || (options = &#123;&#125;);</span><br><span class="line">  _.extend(<span class="keyword">this</span>, _.pick(options, viewOptions));</span><br><span class="line">  <span class="keyword">this</span>._ensureElement();</span><br><span class="line">  <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1、_.uniqueId(‘c/view’)生成唯一cid；<br>2、配置参数options；<br>3、创建View实例；<br>4、初始化。</p>
</blockquote>
</li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">_.extend(<span class="type">View</span>.prototype, <span class="type">Events</span>, &#123;</span><br><span class="line">  // view的默认标签</span><br><span class="line">  tagName: '<span class="keyword">div</span>',</span><br><span class="line">  // 重定义$方法，在当前view查找元素</span><br><span class="line">  $: function(selector) &#123;</span><br><span class="line">    <span class="keyword">return</span> this.$el.find(selector);</span><br><span class="line">  &#125;,</span><br><span class="line">  // 初始化</span><br><span class="line">  initialize: function()&#123;&#125;,</span><br><span class="line">  /**</span><br><span class="line">   * </span><br><span class="line">   * @<span class="keyword">return</span> &#123;[<span class="keyword">type</span>]&#125; [description]</span><br><span class="line">   */</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * _ensureElement 创建<span class="type">View</span>结构</span><br><span class="line">   * this._createElement：创建<span class="type">View</span>结构</span><br><span class="line">   * this.setElement：对<span class="type">DOM</span>元素进行事件解绑，定义this.$el与this.el，绑定</span><br><span class="line">   */</span><br><span class="line">  _ensureElement: function() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!this.el) &#123;</span><br><span class="line">      <span class="keyword">var</span> attrs = _.extend(&#123;&#125;, _.<span class="literal">result</span>(this, 'attributes'));</span><br><span class="line">      <span class="keyword">if</span> (this.id) attrs.id = _.<span class="literal">result</span>(this, 'id');</span><br><span class="line">      <span class="keyword">if</span> (this.className) attrs['class'] = _.<span class="literal">result</span>(this, 'className');</span><br><span class="line">      this.setElement(this._createElement(_.<span class="literal">result</span>(this, 'tagName')));</span><br><span class="line">      this._setAttributes(attrs);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      this.setElement(_.<span class="literal">result</span>(this, 'el'));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  _createElement: function(tagName) &#123;</span><br><span class="line">    <span class="keyword">return</span> document.createElement(tagName);</span><br><span class="line">  &#125;,</span><br><span class="line">  _setAttributes: function(attributes) &#123;</span><br><span class="line">    this.$el.attr(attributes);</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 对<span class="type">View</span>的<span class="type">DOM</span>进行定义与事件处理</span><br><span class="line">   */</span><br><span class="line">  setElement: function(element) &#123;</span><br><span class="line">    this.undelegateEvents();</span><br><span class="line">    this._setElement(element);</span><br><span class="line">    this.delegateEvents();</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * <span class="type">Backbone</span>.$ = $</span><br><span class="line">   * el是<span class="type">Backbone</span>.$的实例</span><br><span class="line">   */</span><br><span class="line">  _setElement: function(el) &#123;</span><br><span class="line">    this.$el = el instanceof <span class="type">Backbone</span>.$ ? el : <span class="type">Backbone</span>.$(el);</span><br><span class="line">    this.el = this.$el[<span class="number">0</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * events格式为&#123;<span class="string">"event selector"</span>: <span class="string">"callback"</span>&#125;</span><br><span class="line">   * 循环events，如果<span class="keyword">method</span>不是function，取this对象的<span class="keyword">method</span>属性方法</span><br><span class="line">   * 不存在<span class="keyword">method</span>，跳过此次循环</span><br><span class="line">   * match取出evnet与selector，_.<span class="keyword">bind</span>的用法？？？</span><br><span class="line">   */</span><br><span class="line">  delegateEvents: function(events) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(events || (events = _.<span class="literal">result</span>(this, 'events')))) <span class="keyword">return</span> this;</span><br><span class="line">    this.undelegateEvents();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> events) &#123;</span><br><span class="line">      <span class="keyword">var</span> <span class="keyword">method</span> = events[key];</span><br><span class="line">      <span class="keyword">if</span> (!_.isFunction(<span class="keyword">method</span>)) <span class="keyword">method</span> = this[events[key]];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">method</span>) <span class="keyword">continue</span>;</span><br><span class="line">      // delegateEventSplitter = /^(\S+)\s*(.*)$/;</span><br><span class="line">      <span class="keyword">var</span> match = key.match(delegateEventSplitter);</span><br><span class="line">      this.delegate(match[<span class="number">1</span>], match[<span class="number">2</span>], _.<span class="keyword">bind</span>(<span class="keyword">method</span>, this));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 解除<span class="type">View</span>事件委托，根据.delegateEvents与cid</span><br><span class="line">   */</span><br><span class="line">  undelegateEvents: function() &#123;</span><br><span class="line">    <span class="keyword">if</span> (this.$el) this.$el.off('.delegateEvents' + this.cid);</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 为<span class="type">View</span>添加事件委托eventName，根据.delegateEvents与cid</span><br><span class="line">   */</span><br><span class="line">  delegate: function(eventName, selector, listener) &#123;</span><br><span class="line">    this.$el.on(eventName + '.delegateEvents' + this.cid, selector, listener);</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 解除<span class="type">View</span>事件委托eventName，根据.delegateEvents与cid</span><br><span class="line">   */</span><br><span class="line">  undelegate: function(eventName, selector, listener) &#123;</span><br><span class="line">    this.$el.off(eventName + '.delegateEvents' + this.cid, selector, listener);</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 移除this.$el，调用<span class="type">Events</span>模块的stopListening</span><br><span class="line">   */</span><br><span class="line">  remove: function() &#123;</span><br><span class="line">    this._removeElement();</span><br><span class="line">    this.stopListening();</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">  &#125;,</span><br><span class="line">  _removeElement: function() &#123;</span><br><span class="line">    this.$el.remove();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二、基于backbone View的扩展<br>define([‘libs’,’header’, ‘cGuiderService’],<br>  function (libs, Header, Guider) {<br>    var PageView = Backbone.View.extend({<br>      // 滚动条位置<br>      scrollPos: { x: 0, y: 0 },<br>      // 标题组件<br>      header: null,<br>      // web 环境下使用pageid<br>      pageid: 0,<br>      // hybrid 环境下使用hpageid<br>      hpageid: 0,<br>      // 页面切换时，是否要滚动至顶部<br>      scrollZero: true,<br>      // 页面切换时，是否执行onHide<br>      triggerShow: true,<br>      // 页面切换时，是否执行onHide<br>      triggerHide: true,<br>      initialize: function () {<br>        this.id = this.$el.attr(“id”);<br>        this.create();<br>      },<br>      // 生成头部<br>      _createHeader: function () {<br>        var hDom = $(‘#headerview’);<br>        this.header = this.headerview = new Header({ ‘root’: hDom });<br>      },<br>      // create 方法,View首次初始化是调用<br>      create: function () {<br>        //调用子类onCreate<br>        this.onCreate &amp;&amp; this.onCreate();<br>      },<br>      // view 销毁方法<br>      destroy: function () {<br>        this.$el.remove();<br>      },<br>      // View 显示时调用的方法<br>      show: function () {<br>        // fix ios 页面切换键盘不消失的bug<br>        document.activeElement &amp;&amp; document.activeElement.blur();<br>        //生成头部<br>        this._createHeader();<br>        //调用子类onShow方法<br>        !this.switchByOut &amp;&amp; this.$el.show();</p>
<pre><code>    <span class="keyword">this</span>.triggerShow &amp;&amp; <span class="keyword">this</span>.onShow &amp;&amp; <span class="keyword">this</span>.onShow();

    <span class="keyword">if</span> (<span class="keyword">this</span>.onBottomPull) {
      <span class="keyword">this</span>._onWidnowScroll = $.proxy(<span class="keyword">this</span>.onWidnowScroll, <span class="keyword">this</span>);
      <span class="keyword">this</span>.addScrollListener();
    }

    <span class="keyword">if</span> (<span class="keyword">this</span>.scrollZero) {
      <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);
    }

    <span class="keyword">this</span>.triggerShow = <span class="literal">true</span>;
    <span class="keyword">this</span>.triggerHide = <span class="literal">true</span>;

    <span class="comment">//如果定义了addScrollListener,说明要监听滚动条事,此方法在cListView中实现</span>
    <span class="keyword">this</span>.addScrollListener &amp;&amp; <span class="keyword">this</span>.addScrollListener();
  },
  <span class="comment">// View 隐藏</span>
  hide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="comment">//调用子类onHide方法</span>
    <span class="keyword">this</span>.triggerHide &amp;&amp; <span class="keyword">this</span>.onHide &amp;&amp; <span class="keyword">this</span>.onHide();
    <span class="keyword">this</span>.removeScrollListener &amp;&amp; <span class="keyword">this</span>.removeScrollListener();
    <span class="keyword">this</span>.$el.hide();
  },

  <span class="comment">// 跨频道跳转</span>
  jump: <span class="function"><span class="keyword">function</span> (<span class="params">opt</span>) </span>{
    <span class="keyword">if</span> (_.isString(opt)) {
      <span class="built_in">window</span>.location.href = opt;
    } <span class="keyword">else</span> {
      Guider.jump(opt);
    }
  },
  <span class="comment">// 前进</span>
  forward: <span class="function"><span class="keyword">function</span> (<span class="params">url, opt</span>) </span>{
    Lizard.forward.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);
  },
  <span class="comment">// 回退至前一页面</span>
  back: <span class="function"><span class="keyword">function</span> (<span class="params">url, opt</span>) </span>{
    Lizard.back.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);
  },
  <span class="comment">// 刷新页面</span>
  refresh: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

  },
  turning: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{

  },
  <span class="comment">// 唤醒App,要求返回一个app接受的字符串</span>
  getAppUrl: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">return</span> <span class="string">""</span>;
  },
  <span class="comment">// 返回URL中参数的值</span>
  getQuery: <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>{
    <span class="keyword">return</span> Lizard.P(key);
  },
  <span class="comment">// 保存滚动条位置</span>
  saveScrollPos: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">this</span>.scrollPos = {
      x: <span class="built_in">window</span>.scrollX,
      y: <span class="built_in">window</span>.scrollY
    };
  },

  <span class="comment">// 恢复原滚动条位置</span>
  restoreScrollPos: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="built_in">window</span>.scrollTo(<span class="keyword">this</span>.scrollPos.x, <span class="keyword">this</span>.scrollPos.y);
  },
  <span class="comment">// 获得页面Url,hyrbid会增加一个虚拟域名</span>
  _getViewUrl: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">var</span> url = <span class="keyword">this</span>._hybridUrl(location.href);
    <span class="keyword">return</span> url;
  },

  _hybridUrl: <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>{
    <span class="keyword">if</span> (Lizard.isInCtripApp)
    {
      <span class="keyword">return</span> <span class="string">'http://hybridm.ctrip.com'</span> + <span class="keyword">this</span>.$el.attr(<span class="string">'page-url'</span>);
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> url;
    }
  }
})
<span class="keyword">return</span> PageView;
</code></pre><p>  });</p>
<p>三、view调用与切换：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cPageModelProcessor负责处理viewCache</span></span><br><span class="line">define([<span class="string">'cPageModelProcessor'</span>, <span class="string">'cUtilPerformance'</span>, <span class="string">'cUtilCommon'</span>, <span class="string">'UILoadingLayer'</span>, (Lizard.isHybrid || Lizard.isInCtripApp) ? <span class="string">'cHybridHeader'</span> : <span class="string">'UIHeader'</span>, <span class="string">'UIWarning404'</span>, <span class="string">'UIAlert'</span>, <span class="string">'UIToast'</span>, <span class="string">'cMessageCenter'</span>, <span class="string">'UIAnimation'</span>, <span class="string">'cPageParser'</span>],</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">callModels, cperformance, utils, Loading, Header, Warning404, Alert, Toast, MessageCenter, animation</span>) </span>&#123;</span><br><span class="line"><span class="comment">// cBaseInit实例化app，循环调用interface</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">APP</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.initialize(options)</span><br><span class="line">&#125;</span><br><span class="line">APP.subclasses = [],</span><br><span class="line"></span><br><span class="line">APP.defaults = &#123;</span><br><span class="line">  <span class="string">"mainRoot"</span>: <span class="string">'#main'</span>,</span><br><span class="line">  <span class="string">"header"</span>: <span class="string">'header'</span>,</span><br><span class="line">  <span class="string">"viewport"</span>: <span class="string">'.main-viewport'</span>,</span><br><span class="line">  <span class="string">"animForwardName"</span>: <span class="string">'slideleft'</span>,</span><br><span class="line">  <span class="string">"animBackwardName"</span>: <span class="string">'slideright'</span>,</span><br><span class="line">  <span class="string">"isAnim"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">//是否开启动画</span></span><br><span class="line">  <span class="string">"maxsize"</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">APP.prototype = &#123;</span><br><span class="line">  ctnrViewNames: [<span class="string">'lizardHisCtnrView'</span>],</span><br><span class="line">  <span class="comment">// 订阅viewReady</span></span><br><span class="line">  viewReady: <span class="function"><span class="keyword">function</span> (<span class="params">handler</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//TODO subscribe viewReady message</span></span><br><span class="line">    MessageCenter.subscribe(<span class="string">'viewReady'</span>, handler);</span><br><span class="line">  &#125;,</span><br><span class="line">  initProperty: <span class="function"><span class="keyword">function</span> <span class="title">initProperty</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> opts = _.extend(&#123;&#125;, APP.defaults, options || &#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> opts;</span><br><span class="line">  &#125;,</span><br><span class="line">  bindEvents: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//l_wang提升响应速度</span></span><br><span class="line">    $.bindFastClick &amp;&amp; $.bindFastClick();</span><br><span class="line">    <span class="comment">//处理a标签</span></span><br><span class="line">    <span class="keyword">this</span>._handleLink();</span><br><span class="line">  &#125;,</span><br><span class="line">  initialize: <span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化配置</span></span><br><span class="line">    <span class="keyword">var</span> opts = <span class="keyword">this</span>.initProperty(options);</span><br><span class="line">    <span class="keyword">this</span>.options = opts;</span><br><span class="line">    <span class="keyword">this</span>.firstState = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.mainRoot = $(opts.mainRoot);</span><br><span class="line">    <span class="keyword">this</span>.header = $(opts.header);</span><br><span class="line">    <span class="keyword">this</span>.viewport = <span class="keyword">this</span>.mainRoot.find(opts.viewport);</span><br><span class="line">    <span class="keyword">this</span>.curView = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.lastView = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//实例化cathViews组件</span></span><br><span class="line">    <span class="keyword">this</span>.maxsize = opts.maxsize;</span><br><span class="line">    <span class="keyword">this</span>.animForwardName = opts.animForwardName;</span><br><span class="line">    <span class="keyword">this</span>.animBackwardName = opts.animBackwardName;</span><br><span class="line">    <span class="keyword">this</span>.isAnim = opts.isAnim;</span><br><span class="line">    <span class="keyword">this</span>.animAPIs = animation;</span><br><span class="line">    <span class="keyword">this</span>.animatName = <span class="keyword">this</span>.animForwardName;</span><br><span class="line">    <span class="comment">// 定义基础UI</span></span><br><span class="line">    <span class="keyword">this</span>._loading = <span class="keyword">new</span> Loading();</span><br><span class="line">    <span class="keyword">this</span>._alert = <span class="keyword">new</span> Alert();</span><br><span class="line">    <span class="keyword">this</span>._confirm = <span class="keyword">new</span> Alert();</span><br><span class="line">    <span class="keyword">this</span>._toast = <span class="keyword">new</span> Toast();</span><br><span class="line">    <span class="keyword">this</span>._warning404 = <span class="keyword">new</span> Warning404();</span><br><span class="line">    <span class="comment">//是否开启hashchange,false为不开启</span></span><br><span class="line">    <span class="keyword">this</span>.observe = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.headerView = <span class="keyword">new</span> Header(&#123; <span class="string">'root'</span>: $(<span class="string">'#headerview'</span>) &#125;);</span><br><span class="line">    <span class="comment">// 绑定事件</span></span><br><span class="line">    <span class="keyword">this</span>.bindEvents();</span><br><span class="line">    <span class="keyword">this</span>.views = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.start();</span><br><span class="line">    <span class="comment">// 订阅switchview</span></span><br><span class="line">    MessageCenter.subscribe(<span class="string">'switchview'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">inView, outView</span>) </span>&#123;</span><br><span class="line">      inView.$el.show();</span><br><span class="line">    &#125;, <span class="keyword">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 链接跳转处理</span></span><br><span class="line">  _handleLink: <span class="function"><span class="keyword">function</span> <span class="title">_handleLink</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!Lizard.isHybrid &amp;&amp; !utils.isSupportPushState) <span class="keyword">return</span>;</span><br><span class="line">    $(<span class="string">'body'</span>).on(<span class="string">'click'</span>, $.proxy(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = $(e.target);</span><br><span class="line">      <span class="keyword">var</span> needhandle = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!el[<span class="number">0</span>]) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (el[<span class="number">0</span>].nodeName == <span class="string">'BODY'</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (el.hasClass(<span class="string">'sub-viewport'</span>)) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (el[<span class="number">0</span>].nodeName == <span class="string">'A'</span>) &#123;</span><br><span class="line">          needhandle = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        el = el.parent();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (needhandle) &#123;</span><br><span class="line">        <span class="keyword">var</span> href = el.attr(<span class="string">'href'</span>);</span><br><span class="line">        <span class="keyword">var</span> opts = &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> lizard_data = el.attr(<span class="string">'lizard-data'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((el.attr(<span class="string">'lizard-catch'</span>) == <span class="string">'off'</span>) || (href &amp;&amp; utils.isExternalLink(href))) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="keyword">if</span> (lizard_data) &#123;</span><br><span class="line">          opts.data = <span class="built_in">JSON</span>.parse(lizard_data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (el.attr(<span class="string">'data-jumptype'</span>) == <span class="string">'back'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.back(el.attr(<span class="string">'href'</span>), opts);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.attr(<span class="string">'data-jumptype'</span>) == <span class="string">'forward'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.goTo(el.attr(<span class="string">'href'</span>), opts);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="keyword">this</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 切换view</span></span><br><span class="line">  switchView: <span class="function"><span class="keyword">function</span> <span class="title">switchView</span>(<span class="params">inView, outView</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (outView &amp;&amp; !<span class="built_in">document</span>.getElementById(outView.id) &amp;&amp; (inView &amp;&amp; !inView.switchByOut)) &#123;</span><br><span class="line">      outView.$el.appendTo(<span class="keyword">this</span>.viewport);</span><br><span class="line">      outView.$el.hide();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inView &amp;&amp; !<span class="built_in">document</span>.getElementById(inView.id)) &#123;</span><br><span class="line">      inView.$el.appendTo(<span class="keyword">this</span>.viewport);</span><br><span class="line">      inView.$el.hide();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//inView.$el.show();</span></span><br><span class="line">    <span class="comment">//动画切换时执行的回调</span></span><br><span class="line">    <span class="keyword">var</span> switchFn;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//此处有问题，如果inView不再的话，应该由firstState生成默认页面</span></span><br><span class="line">    <span class="keyword">if</span> (!inView) <span class="keyword">throw</span> <span class="string">'inview 未被实例化'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将T 、P的值重新设置回去</span></span><br><span class="line">    Lizard.T.lizTmpl = inView.lizTmpl;</span><br><span class="line">    Lizard.P.lizParam = inView.lizParam;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//outView不存在的情况下就不释放动画接口</span></span><br><span class="line">    <span class="keyword">if</span> (outView) &#123;</span><br><span class="line">      outView.saveScrollPos();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.isAnim) &#123;</span><br><span class="line">        switchFn = <span class="keyword">this</span>.animAPIs[<span class="keyword">this</span>.animatName];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//switchFn = this.animAPIs[this.animatName];</span></span><br><span class="line">      <span class="comment">//未定义的话便使用默认的无动画</span></span><br><span class="line">      <span class="comment">//l_wang 此段代码需要做一个包裹，或者需要回调，否则不会执行应该执行的代码!!!</span></span><br><span class="line">      inView.fromView = outView.config.viewName;</span><br><span class="line">      <span class="keyword">if</span> (_.indexOf(<span class="keyword">this</span>.ctnrViewNames, inView.config.viewName) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        MessageCenter.publish(<span class="string">'showHisCtnrView'</span>);</span><br><span class="line">        outView.hideWarning404 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          Lizard.goBack();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (switchFn &amp;&amp; _.isFunction(switchFn)) &#123;</span><br><span class="line">        switchFn(inView, outView, $.proxy(<span class="function"><span class="keyword">function</span> (<span class="params">inView, outView</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>._onSwitchEnd(inView, outView);</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="keyword">this</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        inView &amp;&amp; !inView.switchByOut &amp;&amp; outView.hide();            </span><br><span class="line">        inView.show();</span><br><span class="line">        <span class="keyword">this</span>._onSwitchEnd(inView, outView);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//这里开始走view的逻辑，我这里不予关注</span></span><br><span class="line">      <span class="keyword">if</span> (_.indexOf(<span class="keyword">this</span>.ctnrViewNames, inView.config.viewName) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        MessageCenter.publish(<span class="string">'showHisCtnrView'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      inView.show();</span><br><span class="line">      <span class="keyword">this</span>._onSwitchEnd(inView, outView);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//l_wang 既然使用消息机制，就应该全部使用，后期重构</span></span><br><span class="line">  _onSwitchEnd: <span class="function"><span class="keyword">function</span> (<span class="params">inView, outView</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (outView != inView &amp;&amp; !inView.switchByOut) &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        outView &amp;&amp; outView.$el &amp;&amp; outView.$el.hide()</span><br><span class="line">      &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    inView.sendUbt(<span class="literal">true</span>);</span><br><span class="line">    MessageCenter.publish(<span class="string">'viewReady'</span>, [inView]);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  showView: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.loadView(data.url, data.text, data.options);</span><br><span class="line">  &#125;,        </span><br><span class="line">  <span class="comment">// 根据访问的URL是webapp或者html5不同，响应的数据也不同</span></span><br><span class="line">  <span class="comment">// 根据服务器响应的数据，解析路由配置text/lizard-config，加载view</span></span><br><span class="line">  loadView: <span class="function"><span class="keyword">function</span> (<span class="params">url, html, options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 显示加载UI</span></span><br><span class="line">    <span class="keyword">if</span> ((Lizard.config &amp;&amp; Lizard.config.isHideAllLoading) || options.hideloading) &#123;</span><br><span class="line">      <span class="keyword">this</span>.hideLoading();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.showLoading();</span><br><span class="line">    &#125;</span><br><span class="line">    Lizard.loadingView = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (url) &#123;</span><br><span class="line">      <span class="comment">// view是this.curView或者加载新页面</span></span><br><span class="line">      <span class="keyword">var</span> view = <span class="keyword">this</span>.curView || &#123;</span><br><span class="line">          hpageid: <span class="string">''</span>,</span><br><span class="line">          pageid:<span class="string">''</span>,</span><br><span class="line">          _getViewUrl: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">          &#125;,</span><br><span class="line">          _hybridUrl: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (Lizard.isInCtripApp)</span><br><span class="line">            &#123;                  </span><br><span class="line">              <span class="keyword">return</span> <span class="string">'http://hybridm.ctrip.com'</span> + url;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> ubtURL;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">var</span> ubtURL = <span class="built_in">window</span>.location.protocol + <span class="string">'//'</span> + <span class="built_in">window</span>.location.host + (url.indexOf(Lizard.appBaseUrl) == <span class="number">0</span>?url: Lizard.appBaseUrl + url)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">window</span>.__bfi) <span class="built_in">window</span>.__bfi = [];                    </span><br><span class="line">        <span class="built_in">window</span>.__bfi.push([<span class="string">'_unload'</span>, &#123;</span><br><span class="line">          page_id: Lizard.isHybrid?view.hpageid: view.pageid,</span><br><span class="line">          url: view._hybridUrl(),</span><br><span class="line">          refer: view.$el?view._hybridUrl(<span class="built_in">window</span>.location.protocol + <span class="string">'//'</span> + <span class="built_in">window</span>.location.host + view.$el.attr(<span class="string">'page-url'</span>)):<span class="built_in">document</span>.referrer</span><br><span class="line">      &#125;]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// cPageParser模块中的方法_initParser，负责找到script中的text/lizard-config</span></span><br><span class="line">    <span class="comment">// 解析出viewName与controller、参数、模板、pageUrl</span></span><br><span class="line">    <span class="keyword">var</span> pageConfig = Lizard._initParser(url, html);</span><br><span class="line">    <span class="comment">// 根据pageConfig获取models</span></span><br><span class="line">    callModels(pageConfig, _.bind(<span class="function"><span class="keyword">function</span> (<span class="params">datas, pageConfig</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (_.isFunction(<span class="keyword">this</span>.judgeForward) &amp;&amp; !<span class="keyword">this</span>.judgeForward(url)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Lizard.viewHtmlMap[renderObj.config.viewName] = html;</span><br><span class="line">      <span class="keyword">this</span>.header.html(renderObj.header);</span><br><span class="line">      <span class="keyword">var</span> renderNode = $(<span class="string">'&lt;DIV&gt;&lt;/DIV&gt;'</span>).css(&#123;display: <span class="string">'none'</span>&#125;);</span><br><span class="line">      <span class="comment">// 服务端，renderObj？</span></span><br><span class="line">      <span class="keyword">if</span> (options.renderAt == <span class="string">'server'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hideLoading(); </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        renderNode = $(renderObj.viewport).css(&#123;display: <span class="string">'none'</span>&#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (renderObj.config.showfake &amp;&amp; (!<span class="keyword">this</span>.views[renderObj.config.viewName] || <span class="keyword">this</span>.views[renderObj.config.viewName].$el.attr(<span class="string">'page-url'</span>) != url)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_.isObject(renderObj.config.showfake) &amp;&amp; renderObj.config.showfake.hideloading) &#123;</span><br><span class="line">          <span class="keyword">this</span>.hideLoading();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// renderNode与renderObj.viewport及this.viewport</span></span><br><span class="line">        Lizard.__fakeViewNode = renderNode.appendTo(<span class="keyword">this</span>.viewport);</span><br><span class="line">        <span class="comment">// 当前View</span></span><br><span class="line">        <span class="keyword">this</span>.curView &amp;&amp; <span class="keyword">this</span>.curView.$el.hide();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 加载controller</span></span><br><span class="line">      <span class="built_in">require</span>([renderObj.config.controller||<span class="string">'cPageView'</span>], _.bind(<span class="function"><span class="keyword">function</span> (<span class="params">View</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (_.isFunction(<span class="keyword">this</span>.judgeForward) &amp;&amp; !<span class="keyword">this</span>.judgeForward(url)) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 把this.curView存入this.lastView</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.curView) <span class="keyword">this</span>.lastView = <span class="keyword">this</span>.curView;</span><br><span class="line">        <span class="keyword">if</span> (renderObj.config.viewName &amp;&amp; <span class="keyword">this</span>.views[renderObj.config.viewName]) &#123;</span><br><span class="line">          <span class="comment">// 把要加载的view，存入this.curView</span></span><br><span class="line">          <span class="keyword">this</span>.curView = <span class="keyword">this</span>.views[renderObj.config.viewName];</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.curView.$el.attr(<span class="string">'page-url'</span>) != url) &#123;</span><br><span class="line">            <span class="keyword">this</span>.curView.$el.remove();</span><br><span class="line">            !renderObj.config.showfake &amp;&amp; renderNode.appendTo(<span class="keyword">this</span>.viewport);</span><br><span class="line">            <span class="comment">// 定义view节点</span></span><br><span class="line">            <span class="keyword">this</span>.curView.$el = renderNode;</span><br><span class="line">            <span class="comment">// 执行pageview中的onCreate</span></span><br><span class="line">            <span class="keyword">this</span>.curView.onCreate &amp;&amp; <span class="keyword">this</span>.curView.onCreate();</span><br><span class="line">            <span class="keyword">this</span>.curView.delegateEvents();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          !renderObj.config.showfake &amp;&amp; renderNode.appendTo(<span class="keyword">this</span>.viewport);</span><br><span class="line">          <span class="comment">// 新的View</span></span><br><span class="line">          <span class="keyword">this</span>.curView = <span class="keyword">new</span> View(&#123;</span><br><span class="line">            el: (options.renderAt == <span class="string">'server'</span>) ? <span class="keyword">this</span>.viewport.children().first() : renderNode</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// 设置view节点上的属性url</span></span><br><span class="line">          <span class="keyword">this</span>.curView.$el.attr(<span class="string">'page-url'</span>, url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (options.renderAt == <span class="string">'server'</span>) renderNode.remove();</span><br><span class="line">        <span class="comment">// __fakeViewNode??</span></span><br><span class="line">        Lizard.__fakeViewNode = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 定义this.curView的属性</span></span><br><span class="line">        <span class="keyword">this</span>.curView.text = html;</span><br><span class="line">        _.extend(<span class="keyword">this</span>.curView, _.pick(renderObj, [<span class="string">'datas'</span>, <span class="string">'config'</span>, <span class="string">'lizTmpl'</span>, <span class="string">'lizParam'</span>]));</span><br><span class="line">        <span class="comment">// switchByOut？？</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.curView &amp;&amp; <span class="keyword">this</span>.curView.switchByOut) &#123;</span><br><span class="line">          <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">          <span class="comment">// 重新定义turning</span></span><br><span class="line">          <span class="keyword">this</span>.curView.turning = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.hideLoading();</span><br><span class="line">            <span class="comment">// 隐藏上一个view，发布switchview，显示当前view</span></span><br><span class="line">            self.lastView &amp;&amp; self.lastView.hide();</span><br><span class="line">            MessageCenter.publish(<span class="string">'switchview'</span>, [self.curView, self.lastView]);</span><br><span class="line">            self.curView.$el.show();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.hideLoading();</span><br><span class="line">          MessageCenter.publish(<span class="string">'switchview'</span>, [<span class="keyword">this</span>.curView, <span class="keyword">this</span>.lastView]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.curView.lastViewId = <span class="keyword">this</span>.curView.referrer = (<span class="keyword">this</span>.lastView &amp;&amp; <span class="keyword">this</span>.lastView.config.viewName);</span><br><span class="line">        <span class="keyword">this</span>.switchView(<span class="keyword">this</span>.curView, <span class="keyword">this</span>.lastView);</span><br><span class="line">        <span class="keyword">if</span> (renderObj.config.viewName) &#123;</span><br><span class="line">          <span class="keyword">this</span>.views[renderObj.config.viewName] = <span class="keyword">this</span>.curView;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="keyword">this</span>))</span><br><span class="line">    &#125;, <span class="keyword">this</span>), _.bind(<span class="function"><span class="keyword">function</span> (<span class="params">datas, errorBack</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.hideLoading();</span><br><span class="line">      <span class="keyword">var</span> errorData =</span><br><span class="line">      &#123;</span><br><span class="line">        callback: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.hideWarning404();</span><br><span class="line">          Lizard.goTo(url);</span><br><span class="line">        &#125;,</span><br><span class="line">        headData: &#123;</span><br><span class="line">          title: <span class="string">'网络不给力'</span>,</span><br><span class="line">          back: <span class="literal">true</span>,</span><br><span class="line">          events: &#123;</span><br><span class="line">            returnHandler: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">              Lizard.back();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (errorBack) errorData = _.extend(errorData, errorBack(datas));</span><br><span class="line">      <span class="keyword">this</span>.showWarning404(_.bind(errorData.callback, <span class="keyword">this</span>), pageConfig, errorData);</span><br><span class="line">    &#125;, <span class="keyword">this</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 显示一个全局遮盖层</span></span><br><span class="line">  showHisCtnrView: <span class="function"><span class="keyword">function</span> (<span class="params">onShow, onHide, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.curView &amp;&amp; !options.pageConfig) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.curView &amp;&amp; options.pageConfig) options.addToHistory = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> oldAnimFlag = <span class="keyword">this</span>.isAnim, oldAnimName = <span class="keyword">this</span>.animatName;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.curView) &#123;</span><br><span class="line">      <span class="keyword">this</span>.curView.triggerShow = <span class="keyword">this</span>.curView.triggerHide = options?(!options.triggerFlag):<span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">this</span>.curView.triggerHide = options &amp;&amp; (<span class="string">'triggerHide'</span> <span class="keyword">in</span> options) ?(options.triggerHide):<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.isAnim = (options &amp;&amp; options.isAnim)?<span class="literal">true</span>:<span class="keyword">this</span>.isAnim;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isAnim) &#123;</span><br><span class="line">      <span class="keyword">this</span>.animatName = <span class="keyword">this</span>.animForwardName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> config = _.clone(options.pageConfig?options.pageConfig:<span class="keyword">this</span>.curView.config);</span><br><span class="line">    config.model.apis = [];</span><br><span class="line">    config.view = &#123; viewport: <span class="string">''</span> &#125;;</span><br><span class="line">    config.controller = <span class="string">'cPageView'</span>;</span><br><span class="line">    config.viewName = options &amp;&amp; options.viewName?options.viewName:<span class="string">'lizardHisCtnrView'</span>;</span><br><span class="line">    <span class="keyword">if</span> (_.indexOf(<span class="keyword">this</span>.ctnrViewNames, config.viewName) == -<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">this</span>.ctnrViewNames.push(config.viewName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> url = options.pageConfig?options.pageConfig.pageUrl:<span class="keyword">this</span>.curView.config.pageUrl;</span><br><span class="line">    <span class="keyword">if</span> (!options || options.addToHistory !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (Lizard.isHybrid || Lizard.isInCtripApp)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">this</span>.endObserver();   </span><br><span class="line">        <span class="built_in">window</span>.location.hash = <span class="string">'/lizardHisCtnrView'</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        history.pushState(&#123;url: url, text: <span class="string">' &lt;SCRIPT type="text/lizard-config"&gt;'</span> + <span class="built_in">JSON</span>.stringify(config) + <span class="string">'&lt;'</span> + <span class="string">'/SCRIPT&gt;'</span>, options: &#123;pushState: <span class="literal">true</span>&#125;&#125;, <span class="built_in">document</span>.title, url);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.loadView(url, <span class="string">' &lt;SCRIPT type="text/lizard-config"&gt;'</span> + <span class="built_in">JSON</span>.stringify(config) + <span class="string">'&lt;'</span> + <span class="string">'/SCRIPT&gt;'</span>, &#123; pushState: <span class="literal">true</span>, hideloading: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="keyword">if</span> (Lizard.isHybrid || Lizard.isInCtripApp)</span><br><span class="line">    &#123;</span><br><span class="line">      setTimeout(_.bind(<span class="keyword">this</span>.startObserver, <span class="keyword">this</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> headData = &#123;&#125;;</span><br><span class="line">    MessageCenter.unsubscribe(<span class="string">'showHisCtnrView'</span>);</span><br><span class="line">    MessageCenter.subscribe(<span class="string">'showHisCtnrView'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">this</span>.lizardHisCtnrView = <span class="keyword">this</span>.curView;</span><br><span class="line">      <span class="keyword">this</span>.curView.onShow = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (self.lastView &amp;&amp; !_.isEmpty(self.lastView.header.datamodel)) &#123;</span><br><span class="line">          headData = _.clone(self.lastView.header.datamodel);</span><br><span class="line">          headData.events.returnHandler = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; history.back(); &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.header.set(headData);</span><br><span class="line">        onShow &amp;&amp; onShow.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          self.animatName = self.animBackwardName;</span><br><span class="line">        &#125;, <span class="number">10</span>);            </span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">this</span>.curView.onHide = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        onHide &amp;&amp; onHide.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          self.isAnim = oldAnimFlag;</span><br><span class="line">          self.animatName = oldAnimName;</span><br><span class="line">        &#125;, <span class="number">10</span>)</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">this</span>.curView.show();</span><br><span class="line">    &#125;, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 隐藏遮盖层</span></span><br><span class="line">  hideHisCtnrView: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">  </span>&#123;</span><br><span class="line">    history.back();</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  interface: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">'viewReady'</span>: <span class="keyword">this</span>.viewReady,</span><br><span class="line">      <span class="comment">// 'showMessage': this.showMessage,</span></span><br><span class="line">      <span class="comment">// 'hideMessage': this.hideMessage,</span></span><br><span class="line">      <span class="comment">// 'showConfirm': this.showConfirm,</span></span><br><span class="line">      <span class="comment">// 'hideConfirm': this.hideConfirm,</span></span><br><span class="line">      <span class="comment">// 'showWarning404': this.showWarning404,</span></span><br><span class="line">      <span class="comment">// 'hideWarning404': this.hideWarning404,</span></span><br><span class="line">      <span class="comment">// 'showToast': this.showToast,</span></span><br><span class="line">      <span class="comment">// 'hideToast': this.hideToast,</span></span><br><span class="line">      <span class="comment">// 'showLoading': this.showLoading,</span></span><br><span class="line">      <span class="comment">// 'hideLoading': this.hideLoading,</span></span><br><span class="line">      <span class="string">'showHisCtnrView'</span>: <span class="keyword">this</span>.showHisCtnrView,</span><br><span class="line">      <span class="string">'hideHisCtnrView'</span>: <span class="keyword">this</span>.hideHisCtnrView,</span><br><span class="line">      <span class="string">"goTo"</span>: <span class="keyword">this</span>.goTo,</span><br><span class="line">      <span class="string">"goBack"</span>: <span class="keyword">this</span>.goBack,</span><br><span class="line">      <span class="string">"forward"</span>: <span class="keyword">this</span>.goTo,</span><br><span class="line">      <span class="string">"back"</span>: <span class="keyword">this</span>.goBack,</span><br><span class="line">      <span class="string">"go"</span>: <span class="keyword">this</span>.go</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">ETIQUETADO em</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/MVC/">MVC</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/31/Promise/"  data-tooltip="Promise">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/31/inherent/" data-tooltip="inheritance">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2015 mengyue. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/31/Promise/"  data-tooltip="Promise">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/08/31/inherent/" data-tooltip="inheritance">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://websiteblog.github.io/2015/08/31/switch/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">mengyue</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        <div id="cover" style="background-image:url('http://res.cloudinary.com/tranquilpeak-hexo-theme/image/upload/v1438975482/v1.3.0-cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->



</html>
